---
layout: post
title: 关于开睿思费校园网流量的解释
date: '2012-3-12'
comments: true
---
<!--:zh-->一直以来，很多同学纠结于睿思费流量问题。现在我将服务器端配置及代码中ip判断部分公布，安定人心。

配置文件
```
$xd_ips = array ( //西电IP地址范围
array('127.0.0.1','127.0.0.1'),//本机测试
array('202.117.112.0','202.117.127.255'),
array('210.27.0.0','210.27.15.255'),
array('219.245.64.0','219.245.127.255'),
array('115.155.0.0','115.155.63.255'),
array('222.25.128.0','222.25.191.255'),
array('219.244.112.0','219.244.127.255'),
);
```
tracker中判断部分
```
if (!validip($ip, $xd_ips))
{
err("你的IP地址: $ip 不允许访问本网站!");
}
```
防火墙配置
```
-A INPUT -s 202.117.112.0/255.255.240.0 -i eth1 -p tcp -m tcp --dport 80 -j ACCEPT
-A INPUT -s 210.27.0.0/255.255.240.0 -i eth1 -p tcp -m tcp --dport 80 -j ACCEPT
-A INPUT -s 219.245.64.0/255.255.192.0 -i eth1 -p tcp -m tcp --dport 80 -j ACCEPT
-A INPUT -s 115.155.0.0/255.255.192.0 -i eth1 -p tcp -m tcp --dport 80 -j ACCEPT
-A INPUT -s 222.25.128.0/255.255.192.0 -i eth1 -p tcp -m tcp --dport 80 -j ACCEPT
-A INPUT -s 219.244.112.0/255.255.240.0 -i eth1 -p tcp -m tcp --dport 80 -j ACCEPT
```
nginx配置
```
allow 202.117.112.0/20;
allow 210.27.0.0/20;
allow 219.245.64.0/18;
allow 115.155.0.0/18;
allow 222.25.128.0/18;
allow 219.244.112.0/20;
deny all;
```
所以说，服务器端是不可能返回非西电IP，tracker返回的种子列表均为合法西电IP。若有意外产生外网流量情况发生，请关闭UT的DHT发现和本地用户交换。或限制本地UT只接受西电和ipv6连接。
将下列文件保存为ipfilter.dat并存入utorrent目录下即可，安装版请放入%AppData%\uTorrent目录下（我的电脑，地址栏内如数上述目录即可打开）；绿色版直接放入utorrent安装目录。
```
0.0.0.0 - 115.155.0.0
115.155.63.255 - 202.117.112.0
202.117.127.255 - 210.27.0.0
210.27.15.255 - 219.244.112.0
219.244.127.255 - 219.245.64.0
219.245.127.255 - 222.25.128.0
222.25.191.255 - 255.255.255.255
0::0 - 2001:0:ffff:ffff:ffff:ffff:ffff:ffff 
2002::0-ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff
```<!--:--><!--:en-->一直以来，很多同学纠结于睿思费流量问题。现在我将服务器端配置及代码中ip判断部分公布，安定人心。

配置文件
```
$xd_ips = array ( //西电IP地址范围
array('127.0.0.1','127.0.0.1'),//本机测试
array('202.117.112.0','202.117.127.255'),
array('210.27.0.0','210.27.15.255'),
array('219.245.64.0','219.245.127.255'),
array('115.155.0.0','115.155.63.255'),
array('222.25.128.0','222.25.191.255'),
array('219.244.112.0','219.244.127.255'),
);
```
tracker中判断部分
```
if (!validip($ip, $xd_ips))
{
err("你的IP地址: $ip 不允许访问本网站!");
}
```
防火墙配置
```
-A INPUT -s 202.117.112.0/255.255.240.0 -i eth1 -p tcp -m tcp --dport 80 -j ACCEPT
-A INPUT -s 210.27.0.0/255.255.240.0 -i eth1 -p tcp -m tcp --dport 80 -j ACCEPT
-A INPUT -s 219.245.64.0/255.255.192.0 -i eth1 -p tcp -m tcp --dport 80 -j ACCEPT
-A INPUT -s 115.155.0.0/255.255.192.0 -i eth1 -p tcp -m tcp --dport 80 -j ACCEPT
-A INPUT -s 222.25.128.0/255.255.192.0 -i eth1 -p tcp -m tcp --dport 80 -j ACCEPT
-A INPUT -s 219.244.112.0/255.255.240.0 -i eth1 -p tcp -m tcp --dport 80 -j ACCEPT
```
nginx配置
```
allow 202.117.112.0/20;
allow 210.27.0.0/20;
allow 219.245.64.0/18;
allow 115.155.0.0/18;
allow 222.25.128.0/18;
allow 219.244.112.0/20;
deny all;
```
所以说，服务器端是不可能返回非西电IP，tracker返回的种子列表均为合法西电IP。若有意外产生外网流量情况发生，请关闭UT的DHT发现和本地用户交换。或限制本地UT只接受西电和ipv6连接。
将下列文件保存为ipfilter.dat并存入utorrent目录下即可，安装版请放入%AppData%\uTorrent目录下（我的电脑，地址栏内如数上述目录即可打开）；绿色版直接放入utorrent安装目录。
```
0.0.0.0 - 115.155.0.0
115.155.63.255 - 202.117.112.0
202.117.127.255 - 210.27.0.0
210.27.15.255 - 219.244.112.0
219.244.127.255 - 219.245.64.0
219.245.127.255 - 222.25.128.0
222.25.191.255 - 255.255.255.255
0::0 - 2001:0:ffff:ffff:ffff:ffff:ffff:ffff 
2002::0-ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff
```<!--:-->
